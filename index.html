<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FinanceMaster PRO - Login</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="login-container">
  <h1>FinanceMaster PRO</h1>
  <p>Inicia sesión o regístrate para acceder a tu Dashboard</p>

  <input type="email" id="email" placeholder="Correo electrónico">
  <input type="password" id="password" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
  <button onclick="registro()">Registrarse</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Configuración Firebase
const firebaseConfig = {
  apiKey: "AIzaSyB2nO5sFxNy_-Usg29WcXvk1A676Nt-lhw",
  authDomain: "financemaster-pr0.firebaseapp.com",
  projectId: "financemaster-pr0",
  storageBucket: "financemaster-pr0.firebasestorage.app",
  messagingSenderId: "535862107904",
  appId: "1:535862107904:web:5cc701b94d1084091ddde5",
  measurementId: "G-8MFS6YS282"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Crear documento de usuario en Firestore
async function crearUsuarioFirestore(user) {
  const userRef = doc(db, "usuarios", user.uid);
  const docSnap = await getDoc(userRef);

  if (!docSnap.exists()) {
    await setDoc(userRef, {
      nombre: user.email,
      ingresos: [],
      gastos: [],
      presupuesto: {},
      metas: [],
      deudas: [],
      inversiones: [],
      vencimientos: []
    });
  }
}

// Funciones de login y registro
window.login = () => {
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  signInWithEmailAndPassword(auth,email,pass)
    .then(()=>window.location='dashboard.html')
    .catch(err=>alert(err.message));
};

window.registro = () => {
  const email = document.getElementById('email').value;
  const pass = document.getElementById('password').value;
  createUserWithEmailAndPassword(auth,email,pass)
    .then((userCredential)=>{
      const user = userCredential.user;
      crearUsuarioFirestore(user);
      window.location='dashboard.html';
    })
    .catch(err=>alert(err.message));
};
</script>
</body>
</html>